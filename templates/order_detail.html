{% extends "base.html" %}

{% block content %}

<title>{% block title %}Invoice #{{ order.invoice_no }}{% endblock %}</title>



<div class="mb-4">
  <h3>Order Information</h3>
  <table class="table table-bordered">
    <tr>
      <th>Customer</th>
      <td>{{ order.customer_name }}</td>
    </tr>
    
    <tr>
      <th>Created on</th>
      <td>{{ order.created_at.strftime('%Y-%m-%d') if order.created_at else 'N/A' }}</td>
    </tr>
    <tr>
      <th>Due by</th>
      <td>{{ order.due_date.strftime('%Y-%m-%d') if order.due_date else 'N/A' }}</td>
    </tr>
  </table>

  {% if session.is_staff %}
    <form id="editOrderForm"
          method="POST"
          action="{{ url_for('edit_order', order_id=order.id) }}">
  {% endif %}

  <h4 class="mt-4">Milestone History</h4>
  <table class="table table-bordered">
    <thead>
      <tr><th>Milestone</th><th>Status</th></tr>
    </thead>
    <tbody>
      {% for m in milestones %}
        <tr>
          <td>{{ m.milestone_name }}</td>
          <td>
            {% if session.is_staff %}
              <select name="milestone_status_{{ m.milestone_id }}"
                      class="form-select">
                {% for option in ["Not Started","In Progress","Completed"] %}
                  <option value="{{ option }}"
                    {% if m.status == option %}selected{% endif %}>
                    {{ option }}
                  </option>
                {% endfor %}
              </select>
            {% else %}
              {{ m.status }}
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if session.is_staff %}
    <div class="d-flex gap-2 mt-3">
      <button type="submit" class="btn btn-primary" style="min-width:120px">
        Save Changes
      </button>
      <a href="{{ url_for('portal') }}" class="btn btn-secondary" style="min-width:120px">
        Back to Dashboard
      </a>
    </div>
    </form>

    <form id="deleteOrderForm"
          method="POST"
          action="{{ url_for('delete_order', order_id=order.id) }}"
          onsubmit="return confirm('Are you sure you want to delete this order? This cannot be undone.');"
          class="mt-3">
      <button type="submit" class="btn btn-danger" style="min-width:120px">
        Delete Order
      </button>
    </form>
  {% else %}
    <a href="{{ url_for('client_dashboard') }}" class="btn btn-primary mt-3">
      Back to My Orders
    </a>
  {% endif %}
</div>
{% endblock %}