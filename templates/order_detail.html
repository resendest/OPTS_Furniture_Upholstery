{% extends "base.html" %}

{% block page_title %}Invoice #{{ order.invoice_no }}{% endblock %}

{% block content %}
<div class="mb-4">
  <h3>Order Information</h3>
  {% if session.is_staff %}
    <form id="editOrderForm" method="POST" action="{{ url_for('edit_order', order_id=order.id) }}">
      <table class="table table-bordered">
        <tr>
          <th>Customer</th>
          <td>{{ order.customer_name }}</td>
        </tr>
        <tr>
          <th>Date Created</th>
          <td>{{ order.created_at.strftime('%Y-%m-%d') if order.created_at else 'N/A' }}</td>
        </tr>
        <tr>
          <th>Status</th>
          <td>
            <select id="statusSelect" name="status" class="form-control">
              <option value="Not Started" {% if order.status == "Not Started" %}selected{% endif %}>Not Started</option>
              <option value="In Progress" {% if order.status == "In Progress" %}selected{% endif %}>In Progress</option>
              <option value="Quality Control" {% if order.status == "Quality Control" %}selected{% endif %}>Quality Control</option>
              <option value="Completed" {% if order.status == "Completed" %}selected{% endif %}>Completed</option>
              <option value="Out for Delivery" {% if order.status == "Out for Delivery" %}selected{% endif %}>Out for Delivery</option>
            </select>
          </td>
        </tr>
        
      </table>
    </form>
  {% else %}
    <table class="table table-bordered">
      <tr>
        <th>Order ID</th>
        <td>{{ order.id }}</td>
      </tr>
      <tr>
        <th>Customer</th>
        <td>{{ order.customer_name }}</td>
      </tr>
      <tr>
        <th>Date Created</th>
        <td>{{ order.created_at.strftime('%Y-%m-%d') if order.created_at else 'N/A' }}</td>
      </tr>
      <tr>
        <th>Status</th>
        <td>{{ order.status }}</td>
      </tr>
      
    </table>
    <a href="{{ url_for('client_dashboard') }}" class="btn btn-primary mt-3" style="border-radius: 4px;">Back to My Orders</a>
  {% endif %}
</div>

{% if milestones %}
  <h4 class="mt-4">Milestone History</h4>
  <table class="table table-bordered">
    <thead>
      <tr><th>Milestone</th><th>Status</th></tr>
    </thead>
    <tbody>
      {% for m in milestones %}
        <tr>
          <td>{{ m.milestone_name }}</td>
          <td>{{ m.status }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}

{% if session.is_staff %}
  <div class="d-flex gap-2 mt-3">
    <!-- Save changes button (re-post the edit form) -->
    <button form="editOrderForm" type="submit"
            id="saveBtn" class="btn btn-primary" style="min-width:120px">
      Save Changes
    </button>

    <!-- Back to Dashboard -->
    <a href="{{ url_for('portal') }}"
       class="btn btn-secondary" style="min-width:120px">
      Back to Dashboard
    </a>

    <!-- Delete Order -->
    <form id="deleteOrderForm"
          method="POST"
          action="{{ url_for('delete_order', order_id=order.id) }}"
          onsubmit="return confirm('Are you sure?');"
          style="display:inline">
      <button type="submit"
              class="btn btn-danger text-white"
              style="min-width:120px">
        Delete Order
      </button>
    </form>
  </div>
{% endif %}
{% endblock %}