{% extends "base.html" %}

{% block title %}Order {{ order.order_id }} Status{% endblock %}

{% block content %}
  <h1>Order #{{ order.order_id }} Status</h1>

  <div style="margin-bottom: 1.5rem;">
    <p><strong>Customer ID:</strong> {{ order.customer_id }}</p>
    <p><strong>Invoice Number:</strong> {{ order.invoice_no }}</p>
    {% if order.due_date %}
      <p><strong>Due Date:</strong> {{ order.due_date.strftime("%B %d, %Y") }}</p>
    {% endif %}
  </div>

  <!-- Embed the Work Order PDF for the customer -->
  {% if order.pdf_path %}
    <div style="margin-bottom: 1.5rem;">
      <h2>Work Order PDF</h2>
      <iframe
        src="{{ url_for('work_orders', filename='order_' ~ order.order_id ~ '.pdf') }}"
        width="100%"
        height="500px"
        style="border: 1px solid #ccc;"
      >
        Your browser does not support iframes. 
        <a href="{{ url_for('work_orders', filename='order_' ~ order.order_id ~ '.pdf') }}">
          Download PDF
        </a>
      </iframe>
    </div>
  {% endif %}

  <!-- List of Milestones and Their Statuses -->
  <h2>Milestones</h2>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th style="text-align:center;">Stage #</th>
          <th>Milestone</th>
          <th style="text-align:center;">Client Action?</th>
          <th style="text-align:center;">Approved?</th>
        </tr>
      </thead>
      <tbody>
        {% for m in milestones %}
          <tr>
            <td style="text-align:center;">{{ m.stage_number }}</td>
            <td>{{ m.milestone_name }}</td>
            <td style="text-align:center;">{{ "Yes" if m.is_client_action else "No" }}</td>
            <td style="text-align:center;">
              {% if m.is_approved %}
                <span style="color: green; font-weight: bold;">✓</span>
              {% else %}
                <span style="color: red;">✗</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
